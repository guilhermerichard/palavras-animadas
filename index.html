<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Palavras Animadas — Partículas e Efeitos</title>
<style>
    :root{
        --bg:#05030a;
        --accent:#7be3ff;
        --muted:rgba(255,255,255,0.12);
    }
    html,body{height:100%;margin:0;font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    body{
        background: radial-gradient(circle at 15% 10%, rgba(123,227,255,0.04), transparent 6%),
                    linear-gradient(180deg, #05030a 0%, #06061a 100%);
        color:#fff;
        overflow:hidden;
    }

    /* Canvas fundo (partículas) cobre toda a tela */
    #bg-canvas{
        position:fixed;
        inset:0;
        z-index:0;
        display:block;
    }

    /* Container principal */
    .stage{
        position:relative;
        width:100%;
        height:100%;
        z-index:2;
        display:flex;
        align-items:center;
        justify-content:center;
        pointer-events:none; /* permite clique nos botões flutuantes */
    }

    /* Caixa da palavra central */
    #palavra-central {
        pointer-events:auto;
        position:relative;
        transform-style:preserve-3d;
        text-align:center;
        font-weight:800;
        letter-spacing:0.02em;
        color: #ffffff;
        text-shadow: 0 6px 18px rgba(0,0,0,0.6), 0 0 24px rgba(123,227,255,0.06);
        user-select:none;
    }

    /* tamanho responsivo */
    #palavra-central .texto {
        display:inline-block;
        font-size: clamp(32px, 8vw, 96px);
        transition: transform 420ms cubic-bezier(.2,.9,.25,1), opacity 350ms ease;
        transform-origin:center center;
    }

    /* Efeito de explosão (burst) */
    .burst {
        position:absolute;
        left:50%;
        top:50%;
        transform:translate(-50%,-50%);
        width:240px;
        height:240px;
        pointer-events:none;
        filter: blur(8px);
        opacity:0;
    }

    .burst.show {
        opacity:1;
        animation: burstIn 420ms ease-out forwards;
    }

    @keyframes burstIn {
        0% { transform: translate(-50%,-50%) scale(0.4); opacity:0.9; filter: blur(20px); }
        100%{ transform: translate(-50%,-50%) scale(1.0); opacity:0; filter: blur(0px); }
    }

    /* Controles flutuantes (esquerda cima) */
    .controls {
        position:fixed;
        top:18px;
        left:18px;
        z-index:6;
        display:flex;
        gap:10px;
        pointer-events:auto;
    }

    .btn {
        background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
        border: 1px solid rgba(255,255,255,0.06);
        color: white;
        padding:10px 14px;
        border-radius:10px;
        font-size:15px;
        cursor:pointer;
        backdrop-filter: blur(6px);
        box-shadow: 0 6px 18px rgba(11,14,24,0.6);
    }
    .btn:hover{ transform: translateY(-2px); }

    /* Botões direcionais (direita) */
    .nav {
        position:fixed;
        right:18px;
        top:18px;
        z-index:6;
        display:flex;
        gap:10px;
        pointer-events:auto;
    }

    .round {
        width:52px;
        height:52px;
        border-radius:12px;
        display:flex;
        align-items:center;
        justify-content:center;
        font-weight:700;
        font-size:20px;
    }

    /* Histórico no canto inferior direito */
    #lista {
        position:fixed;
        right:20px;
        bottom:20px;
        z-index:6;
        text-align:right;
        max-width:320px;
        pointer-events:auto;
        color: rgba(255,255,255,0.86);
        font-size:16px;
    }
    #lista .titulo {
        font-size:13px;
        color:var(--muted);
        margin-bottom:6px;
    }
    #lista .item {
        display:block;
        padding:4px 6px;
        border-radius:6px;
        background: linear-gradient(90deg, rgba(255,255,255,0.02), transparent);
        margin-top:6px;
        transform-origin:right center;
        transition: transform 300ms ease, opacity 300ms ease;
        opacity:0.95;
    }

    /* Animacao palavra voando (entrando) */
    .flying {
        position:fixed;
        z-index:5;
        left:50%;
        top:50%;
        transform-style:preserve-3d;
        pointer-events:none;
    }

    /* efeito tipo máquina de escrever (cursor) */
    .typewriter {
        border-right: 3px solid rgba(255,255,255,0.85);
        padding-right:6px;
        animation: blinkCursor 900ms steps(1) infinite;
    }
    @keyframes blinkCursor { from{border-right-color:rgba(255,255,255,0.85);} to{border-right-color:transparent;} }

    /* pequena instrução */
    .hint {
        position:fixed;
        left:50%;
        transform:translateX(-50%);
        bottom:12px;
        z-index:6;
        color:rgba(255,255,255,0.6);
        font-size:13px;
        pointer-events:none;
    }

    /* responsividade do histórico */
    @media (max-width:640px){
        #lista{ right:10px; left:10px; text-align:center; max-width:none; }
    }
</style>
</head>
<body>

<!-- Canvas de fundo para partículas -->
<canvas id="bg-canvas"></canvas>

<!-- Stage -->
<div class="stage" aria-hidden="true">
    <div id="palavra-central" aria-live="polite">
        <div class="texto">Pronto</div>
        <div class="burst" id="burst"></div>
    </div>
</div>

<!-- Botões e controles -->
<div class="controls">
    <button class="btn" id="btn-gerar" title="Gerar novas palavras">Gerar Novas Palavras</button>
    <button class="btn" id="btn-shuffle" title="Embaralhar novamente">Embaralhar</button>
</div>

<div class="nav">
    <button class="btn round" id="btn-voltar" title="Voltar (←)">←</button>
    <button class="btn round" id="btn-avancar" title="Avançar (→)">→</button>
</div>

<!-- Lista de palavras já mostradas -->
<div id="lista" aria-hidden="false">
    <div class="titulo">Palavras mostradas</div>
    <!-- itens serão inseridos aqui -->
</div>

<div class="hint">Use ← e → ou os botões. Toque em "Gerar Novas Palavras" para começar.</div>

<script>
/* =========================
   CONFIG / GERAÇÃO DE PALAVRAS
   ========================= */
const BASE = [
    "Amor","Força","Destino","Vitória","Alegria","Paz","Energia","Natureza","Luz","Esperança",
    "Sabedoria","Caminho","União","Vida","Magia","Coragem","Liberdade","Paixão","Futuro","Mistério",
    "Sorte","Criatividade","Beleza","Verdade","Equilíbrio","Conquista","Inspiração","Mudança","Brilho","Horizonte",
    "Sopro","Ritmo","Memória","Aurora","Vínculo","Vento","Maré","Graça","Fagulha","Silêncio"
];

function shuffleArray(arr){
    for(let i = arr.length -1; i > 0; i--){
        const j = Math.floor(Math.random() * (i+1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
}

/* Cria uma sequência nova (10 palavras por padrão) */
function gerarSequencia(n = 12){
    const pool = [...BASE];
    shuffleArray(pool);
    return pool.slice(0, n);
}

/* Estado */
let palavras = gerarSequencia(12);
let index = -1; // índice da palavra atual em palavras
let usadas = []; // histórico mostrado
const central = document.querySelector('#palavra-central .texto');
const burst = document.getElementById('burst');
const listaEl = document.getElementById('lista');

/* =========================
   SOM: WebAudio simples (swoosh + click)
   ========================= */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playSwoosh() {
    const now = audioCtx.currentTime;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = 'sine';
    o.frequency.setValueAtTime(220, now);
    o.frequency.exponentialRampToValueAtTime(900, now + 0.22);
    g.gain.setValueAtTime(0.0001, now);
    g.gain.exponentialRampToValueAtTime(0.12, now + 0.02);
    g.gain.exponentialRampToValueAtTime(0.0001, now + 0.28);
    o.connect(g);
    g.connect(audioCtx.destination);
    o.start(now);
    o.stop(now + 0.35);
}

function playClick(){
    const now = audioCtx.currentTime;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = 'square';
    o.frequency.setValueAtTime(800, now);
    g.gain.setValueAtTime(0.0001, now);
    g.gain.exponentialRampToValueAtTime(0.08, now + 0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, now + 0.12);
    o.connect(g);
    g.connect(audioCtx.destination);
    o.start(now);
    o.stop(now + 0.14);
}

/* =========================
   ATUALIZA LISTA (histórico)
   ========================= */
function atualizarLista(){
    // remove itens antigos (exceto título)
    const existing = listaEl.querySelectorAll('.item');
    existing.forEach(n => n.remove());

    usadas.slice().reverse().forEach((p, i) => {
        const div = document.createElement('div');
        div.className = 'item';
        div.textContent = p;
        div.style.transform = `translateY(${i*6}px)`;
        div.style.opacity = `${1 - i*0.05}`;
        listaEl.appendChild(div);
    });
}

/* =========================
   FUNÇÕES DE EXIBIÇÃO E ANIMAÇÕES
   ========================= */

/* Efeito "palavra voando em 3D" antes de fixar no centro */
function animateFlyingWord(text, onComplete){
    // cria elemento voador
    const flying = document.createElement('div');
    flying.className = 'flying';
    flying.style.left = (Math.random()*80 + 10) + '%'; // start x random
    flying.style.top = (Math.random()*80 + 10) + '%'; // start y random
    flying.style.fontSize = getComputedStyle(central).fontSize;
    flying.style.fontWeight = '800';
    flying.style.pointerEvents = 'none';
    flying.style.transform = `translate3d(-50%,-50%,${Math.random()*400 - 200}px) rotateX(${Math.random()*40 - 20}deg) rotateY(${Math.random()*40 - 20}deg)`;
    flying.style.opacity = 0;
    flying.textContent = text;
    document.body.appendChild(flying);

    // força reflow para animar
    requestAnimationFrame(() => {
        flying.style.transition = 'transform 520ms cubic-bezier(.17,.84,.44,1), opacity 420ms ease';
        flying.style.opacity = 1;
        flying.style.transform = `translate3d(50vw,50vh,0px) translate(-50%,-50%) rotateX(0deg) rotateY(0deg) scale(1.02)`;
    });

    setTimeout(()=> {
        // burst visual
        burst.classList.add('show');
        setTimeout(()=> burst.classList.remove('show'), 420);

        // anima para centro e aplica tipo máquina de escrever
        central.style.opacity = '0';
        central.style.transform = 'scale(0.96)';
        setTimeout(() => {
            // limpa e define novo texto com efeito typewriter
            typeText(text, central, () => {
                central.style.opacity = '1';
                central.style.transform = 'scale(1)';
                // remove flying
                flying.remove();
                if(onComplete) onComplete();
            });
        }, 140);
    }, 400);

    // som
    playSwoosh();
}

/* Máquina de escrever: escreve texto letra a letra em container (node pode ser elemento inline). */
function typeText(fullText, node, cb){
    const speed = 36; // ms por caractere
    node.textContent = '';
    node.classList.add('typewriter');
    let i = 0;
    function step(){
        if(i <= fullText.length - 1){
            node.textContent += fullText[i++];
            setTimeout(step, speed + Math.random()*28);
        } else {
            // remove cursor depois de um instante
            setTimeout(()=> node.classList.remove('typewriter'), 260);
            if(cb) cb();
        }
    }
    step();
}

/* Mostra próxima palavra */
function mostrarProxima(){
    // se não tiver mais palavras, embaralha e continua (comportamento infinito)
    if(index + 1 >= palavras.length){
        // rearranja sem perder contexto (infinite shuffle)
        palavras = palavras.concat(gerarSequencia(8));
        shuffleArray(palavras);
        // continue; (podemos continuar)
    }
    index++;
    const p = palavras[index];
    usadas.push(p);
    animateFlyingWord(p, () => {
        atualizarLista();
    });
    playClick(); // click final
}

/* Volta para palavra anterior (se existir) */
function voltarAnterior(){
    if(usadas.length <= 1) return; // nada para voltar (mantém a atual)
    // remove última mostrada e re-insere no array de futuras no início
    const ultimo = usadas.pop();
    index = Math.max(0, index - 1);
    // move a palavra removida de volta para futuro (coloca no início da fila)
    palavras.splice(index + 1, 0, ultimo);
    const atual = usadas[usadas.length - 1] || 'Pronto';
    // animação de rewriting (sem flying)
    central.style.opacity = '0';
    setTimeout(()=> {
        typeText(atual, central, ()=> {
            central.style.opacity = '1';
            atualizarLista();
            playClick();
        });
    }, 180);
}

/* Embaralhar restante (mantém já mostradas) */
function shuffleRemaining(){
    const remaining = palavras.slice(index + 1);
    shuffleArray(remaining);
    palavras = palavras.slice(0, index + 1).concat(remaining);
}

/* Gerar novas palavras e resetar tudo */
function gerarNovas(){
    palavras = gerarSequencia(12);
    index = -1;
    usadas = [];
    central.textContent = 'Pronto';
    atualizarLista();
}

/* =========================
   EVENTOS (teclado e botões)
   ========================= */
document.getElementById('btn-avancar').addEventListener('click', ()=> mostrarProxima());
document.getElementById('btn-voltar').addEventListener('click', ()=> voltarAnterior());
document.getElementById('btn-gerar').addEventListener('click', ()=> { gerarNovas(); playClick(); });
document.getElementById('btn-shuffle').addEventListener('click', ()=> { shuffleRemaining(); playClick(); });

document.addEventListener('keydown', (e) => {
    if(e.key === 'ArrowRight'){ e.preventDefault(); mostrarProxima(); }
    if(e.key === 'ArrowLeft'){ e.preventDefault(); voltarAnterior(); }
});

/* Toque: ativa áudio se não desbloqueado (iOS/Android) */
function unlockAudio(){
    if(audioCtx.state === 'suspended') {
        audioCtx.resume();
    }
    window.removeEventListener('touchstart', unlockAudio);
}
window.addEventListener('touchstart', unlockAudio, {passive:true});

/* =========================
   Partículas / Fundo (estrelas flutuantes)
   ========================= */
const canvas = document.getElementById('bg-canvas');
const ctx = canvas.getContext('2d');
let W = canvas.width = innerWidth;
let H = canvas.height = innerHeight;
const stars = [];
const STAR_COUNT = Math.round((W * H) / 42000) + 40;

function rand(min,max){ return Math.random()*(max-min)+min; }
function makeStars(){
    stars.length = 0;
    for(let i=0;i<STAR_COUNT;i++){
        stars.push({
            x: Math.random()*W,
            y: Math.random()*H,
            r: Math.random()*1.6 + 0.2,
            vx: (Math.random()-0.5)*0.15,
            vy: (Math.random()-0.5)*0.15,
            alpha: rand(0.06,0.9),
            twinkle: Math.random()*0.02 + 0.002
        });
    }
}

function draw(){
    ctx.clearRect(0,0,W,H);
    // gradiente leve
    const g = ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0, 'rgba(12,8,20,0.35)');
    g.addColorStop(1, 'rgba(2,2,8,0.6)');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,W,H);

    // desenha estrelas
    for(let s of stars){
        s.x += s.vx;
        s.y += s.vy;
        s.alpha += Math.sin(Date.now() * s.twinkle) * 0.0018;
        if(s.x < -20) s.x = W + 20;
        if(s.x > W + 20) s.x = -20;
        if(s.y < -20) s.y = H + 20;
        if(s.y > H + 20) s.y = -20;

        ctx.beginPath();
        const glow = ctx.createRadialGradient(s.x, s.y, 0, s.x, s.y, s.r*6);
        glow.addColorStop(0, `rgba(123,227,255,${0.12 * s.alpha})`);
        glow.addColorStop(0.5, `rgba(123,227,255,${0.06 * s.alpha})`);
        glow.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.fillStyle = glow;
        ctx.fillRect(s.x - s.r*6, s.y - s.r*6, s.r*12, s.r*12);

        ctx.beginPath();
        ctx.fillStyle = `rgba(255,255,255,${0.9 * s.alpha})`;
        ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
        ctx.fill();
    }

    requestAnimationFrame(draw);
}

window.addEventListener('resize', ()=> {
    W = canvas.width = innerWidth;
    H = canvas.height = innerHeight;
    makeStars();
});

/* inicializa */
makeStars();
draw();
atualizarLista();

/* Small improvement: autoplay first word after user clicks Gerar ou pressiona seta.
   But we will not auto-start audio without user gesture (we unlock on touchstart). */
</script>

</body>
</html>
